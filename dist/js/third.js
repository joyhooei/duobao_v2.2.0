function thirdGetData(){null!=$.getUrlParam("userId")&&null!=$.getUrlParam("token")?(window.sessionStorage.setItem("thirdId",$.getUrlParam("userId")),window.sessionStorage.setItem("thirdToken",$.getUrlParam("token")),window.sessionStorage.setItem("thirdIntype",$.getUrlParam("intype")),window.sessionStorage.setItem("thirdPlatform",$.getUrlParam("platform")),window.sessionStorage.setItem("thirdNickname",decodeURIComponent($.getUrlParam("nickname"))),window.sessionStorage.setItem("thirdTel",$.getUrlParam("tel")),window.sessionStorage.setItem("thirdUserLogo",$.getUrlParam("userLogo")),window.sessionStorage.setItem("thirdCurrency",decodeURIComponent($.getUrlParam("currency"))),luanmingli.thirdId=$.getUrlParam("userId"),luanmingli.third.token=$.getUrlParam("token"),luanmingli.third.intype=$.getUrlParam("intype"),luanmingli.third.platform=$.getUrlParam("platform"),luanmingli.third.nickname=decodeURIComponent($.getUrlParam("nickname")),luanmingli.third.tel=$.getUrlParam("tel"),luanmingli.third.userLogo=$.getUrlParam("userLogo"),luanmingli.third.currency=decodeURIComponent($.getUrlParam("currency"))):(luanmingli.thirdId=window.sessionStorage.getItem("thirdId"),luanmingli.third.token=window.sessionStorage.getItem("thirdToken"),luanmingli.third.intype=window.sessionStorage.getItem("thirdIntype"),luanmingli.third.platform=window.sessionStorage.getItem("thirdPlatform"),luanmingli.third.nickname=decodeURIComponent(window.sessionStorage.getItem("thirdNickname")),luanmingli.third.tel=window.sessionStorage.getItem("thirdTel"),luanmingli.third.userLogo=window.sessionStorage.getItem("thirdUserLogo"),luanmingli.third.currency=decodeURIComponent(window.sessionStorage.getItem("thirdCurrency")))}function thirdLogin(){$.ajax({type:"get",url:luanmingli.getUrl+"saveAuthPlat",data:{v:luanmingli.srvVersion,content:encryptByDES(JSON.stringify({userId:luanmingli.thirdId,token:luanmingli.third.token,platform:luanmingli.third.platform,nickname:luanmingli.third.nickname,tel:luanmingli.third.tel,userLogo:luanmingli.third.userLogo}))},async:!1,dataType:"json",success:function(e){0==e.stateCode?(luanmingli.channel=e.userInfo.channelid,luanmingli.userId=e.userInfo.userId,luanmingli.userInfo=e.userInfo,window.localStorage.setItem("userId",e.userInfo.userId),window.localStorage.setItem("userInfo",JSON.stringify(e.userInfo)),window.localStorage.setItem("userKey",e.userInfo.userKey),window.localStorage.setItem("mid",CryptoJS.MD5(e.userInfo.userId).toString()),window.sessionStorage.setItem("trirdHaveLogin",1),window.sessionStorage.setItem("channel",e.userInfo.channelid)):$.alert(e.message)}})}function thirdPay(){var e=function(){var e=$(".p-bonus-ipt").attr("name");return e?e:"0"};$("#p-pay").find(".pay-third-box").show(),null!=luanmingli.third.currency&&"null"!=luanmingli.third.currency&&luanmingli.third.currency&&($("#p-pay").find(".pay-third-box").find(".a-pay-third-way").html(luanmingli.third.currency+"支付"),thirdPayWayName=luanmingli.third.currency),$(".p-pay-button").click(function(){var n=$(".z_pay_money_left").html();if($(".p_pay_way").find("input[type=radio]:checked").hasClass("third")&&0!=n){way=21;var i;null!=luanmingli.third.currency&&"null"!=luanmingli.third.currency&&luanmingli.third.currency&&($("#p-pay").find(".pay-third-box").find(".a-pay-third-way").html(luanmingli.third.currency+"支付"),thirdPayWayName=luanmingli.third.currency),$.confirm("是否确认使用"+thirdPayWayName+"支付？",function(){i="",luanmingli.orderInfo.cost==n?candyPrePayUrl=luanmingli.getUrl+"prePay?v="+luanmingli.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:way,orderId:luanmingli.orderInfo.orderId,userId:luanmingli.userId,secret:luanmingli.orderInfo.secret,points:0,hongbaoId:e()}))):candyPrePayUrl=luanmingli.getUrl+"prePay?v="+luanmingli.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:way,way:way,orderId:luanmingli.orderInfo.orderId,userId:luanmingli.userId,secret:luanmingli.orderInfo.secret,points:$(".z_pay_gold").html(),hongbaoId:e()}))),integralPay(candyPrePayUrl)}),window.sessionStorage.setItem("paying",luanmingli.orderInfo.orderId)}})}function integralPay(e){$(".z_pay_money_left").html();$.showIndicator(),$.ajax({type:"post",url:e,async:!0,dataType:"json",success:function(e){setTimeout(function(){$.hideIndicator(),0==e.stateCode?$.router.load("pay-success.html"):"积分"!=thirdPayWayName&&/积分/.test(e.message)?$.alert(e.message.replace(/积分/,thirdPayWayName+"余额")):$.alert(e.message)},200)},error:function(){$.alert("请求服务器超时，请重试")}})}function thirdRefreshButton(){$.whichPage("p-receipt")||$.whichPage("p-bindtel")||$.whichPage("p-bonus")||luanmingli.thirdId&&!luanmingli.third.backUrl&&0==$(".qktback").length&&$('<a class="icon icon-refresh pull-right qktback" onclick="javascript:window.location.reload(true);" style="font-size:.8rem;"></a>').appendTo($(".page header"))}$(function(){try{luanmingli.third={},thirdGetData(),luanmingli.thirdId&&!window.sessionStorage.getItem("trirdHaveLogin")&&thirdLogin(),$.whichPage("p-pay")&&(2!=luanmingli.third.intype&&2!=$.getUrlParam("intype")&&2!=window.sessionStorage.getItem("intype")||thirdPay()),thirdRefreshButton()}catch(e){}});var thirdPayWayName="积分";