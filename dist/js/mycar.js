var mycar=function(t){function e(e){t(document).off("infinite","#p-mycar .infinite-scroll"),t(document).on("infinite","#p-mycar .infinite-scroll",function(){c||(c=!0,t.showIndicator(),setTimeout(function(){return o&&e>=o?void setTimeout(function(){t.hideIndicator(),t.toast("没有更多数据",1e3,"toast-80"),setTimeout(function(){c=!1},1e3)},200):void n(e+1,function(){setTimeout(function(){t.hideIndicator(),t.toast("加载成功",1e3,"toast-80"),c=!1},100)})},100))})}var o,n=function(n,a){if(1==n){if(t(".chest_model").length>0&&null==window.localStorage.getItem("chestForceRefresh"))return;t(".chest_model").remove()}if(t.showIndicator(),t.getUrlParam("carId"))var r={currentPage:n,v:luanmingli.srvVersion,carId:t.getUrlParam("carId")};else var r={currentPage:n,v:luanmingli.srvVersion,userId:luanmingli.userId};t.ajax({type:"get",url:luanmingli.getUrl+"getTreasureList",data:r,async:!0,dataType:"json",success:function(r){if(0==r.stateCode){if(0==r.totalPage&&0==r.treasureInfoList.length&&t.alert("请输入正确的车牌号",function(){t.router.back()}),0==r.treasureInfoList.length&&t.alert("暂无商品",function(){t.router.back()}),n>r.totalPage)return;t.each(r.treasureInfoList,function(t,e){i("#p-mycar .content",e)}),o=r.totalPage,e(r.currentPage),a&&a(),setTimeout(function(){t.hideIndicator()},500)}else 3==r.stateCode?t.alert("请输入正确的车牌号",function(){t.router.back()}):t.alert(r.message)}})},i=function(e,o){t(e).append('<div onclick="mycar.routerToDuobao('+o.treasureId+')" class="chest_model card"><div valign="bottom" class="card-header color-white no-border no-padding"><img class="card-cover" src='+o.goodsInfo.picUrl+' alt=""></div><div class="card-content"><div class="card-content-inner list_info"><div class="clearfix stage_info"><p class="stage_text"><span>'+o.goodsInfo.describe+'</span></p></div><div class="clearfix"><div class="schedule pull-left clearfix"><div class="schedule_bar"><div class="scheduling" style="width:'+o.participantCount/o.totalCount*100+'%;"></div></div><div class="pull-left"><p class="schedule_percent">'+o.totalCount+'</p><p>总需</p></div><div class="schedule_text2 pull-right"><p class="schedule_person">'+(o.totalCount-o.participantCount)+'</p><p>剩余</p></div></div><button class="global_button participate button pull-right">立即夺宝</button></div></div></div></div>')},a=function(){t(".chest_model").remove(),n(1)},r=function(e){t.showIndicator(),t.router.load("duobao.html?treasureId="+e)},c=!1,s=function(){t(".j-car-record").click(function(){t.router.load("car-record.html")})},l=function(){n(1),dropRefresh("#p-mycar",a),s()};return{init:l,routerToDuobao:r}}(Zepto);mycar.init();