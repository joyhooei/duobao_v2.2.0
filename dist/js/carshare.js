var carshare=function(t){function e(e){t(document).off("infinite","#p-carshare .infinite-scroll"),1!=i&&t(document).on("infinite","#p-carshare .infinite-scroll",function(){c||(c=!0,t.showIndicator(),setTimeout(function(){return i&&e>=i?void setTimeout(function(){t.hideIndicator(),t.toast("没有更多数据",1e3,"toast-80"),setTimeout(function(){c=!1},1e3)},200):void a(e+1,function(){setTimeout(function(){t.hideIndicator(),t.toast("加载成功",1e3,"toast-80"),c=!1},100)})},100))})}var i;if(!t.getUrlParam("carId"))return void t.alert("车牌号有误");var a=function(a,o){if(1==a){if(t(".chest_model").length>0&&null==window.localStorage.getItem("chestForceRefresh"))return;t(".chest_model").remove()}t.showIndicator(),t.ajax({type:"get",url:luanmingli.getUrl+"getTreasureList",data:{currentPage:a,v:luanmingli.srvVersion,carId:t.getUrlParam("carId")},async:!0,dataType:"json",success:function(r){0==r.totalPage&&0==r.treasureInfoList.length&&t.alert("请输入正确的车牌号",function(){t.router.back()}),a>r.totalPage||(t.each(r.treasureInfoList,function(t,e){n("#p-carshare .content",e)}),i=r.totalPage,e(r.currentPage),o&&o(),setTimeout(function(){t.hideIndicator()},500))}})},n=function(e,i){t(e).append('<div onclick="carshare.routerToDuobao('+i.treasureId+')" class="chest_model card"><div valign="bottom" class="card-header color-white no-border no-padding"><img class="card-cover" src='+i.goodsInfo.picUrl+' alt=""></div><div class="card-content"><div class="card-content-inner list_info"><div class="clearfix stage_info"><p class="stage_text"><span>'+i.goodsInfo.describe+'</span></p></div><div class="clearfix"><div class="schedule pull-left clearfix"><div class="schedule_bar"><div class="scheduling" style="width:'+i.participantCount/i.totalCount*100+'%;"></div></div><div class="pull-left"><p class="schedule_percent">'+i.totalCount+'</p><p>总需</p></div><div class="schedule_text2 pull-right"><p class="schedule_person">'+(i.totalCount-i.participantCount)+'</p><p>剩余</p></div></div><button class="global_button participate button pull-right">立即夺宝</button></div></div></div></div>')},o=function(){t(".chest_model").remove(),a(1)},r=function(e){s()||(t.showIndicator(),t.router.load("duobao.html?treasureId="+e))},c=!1,s=function(){var e=!1,i=function(){return t.device.ios?"在Safari中打开":"在浏览器中打开"};return(navigator.userAgent.indexOf("QQ")>-1||navigator.userAgent.indexOf("MicroMessenger")>-1)&&(t.popup('<div class="popup wxqq"><div class="u-arrow"></div><div class="u-alert"><div class="alert-text">点击右上角按钮<br />选择“'+i()+"”<br />前往购买</div></div></div>"),t(".wxqq").click(function(){t.closeModal(".wxqq")}),e=!0),e},l=function(){t(".car-down-btn").click(function(){s()||(t.device.ios?window.location.href="https://itunes.apple.com/us/app/huang-jin-duo-bao/id1144036041?l=zh&ls=1&mt=8":window.location.href="http://alicdn.2333db.com/apk/yyj-2.4.3-fenxiang_312250.apk")})},d=function(){var e=t.getUrlParam("carId");t(".a-car-num").html(e)},u=function(){l(),a(1),dropRefresh("#p-carshare",o),d()};return{init:u,routerToDuobao:r}}(Zepto);carshare.init();