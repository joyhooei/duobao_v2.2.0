function chestFillData(t,e){if(1==t){if($(".chest_model").length>0&&null==window.localStorage.getItem("chestForceRefresh"))return;$(".chest_model").remove()}$.showIndicator(),$.ajax({type:"get",url:luanmingli.getUrl+"getTreasureList",data:{currentPage:t,order:1,type:2,v:luanmingli.srvVersion},async:!0,dataType:"json",success:function(o){t>o.totalPage||($.each(o.treasureInfoList,function(t,e){appendData("#p-chest .content",e)}),chestTotlePage=o.totalPage,chestBottomLoadmore(o.currentPage),e&&e(),window.localStorage.removeItem("chestForceRefresh"),setTimeout(function(){$.hideIndicator()},500))}})}function appendData(t,e){$(t).append('<div onclick="routerToDuobao('+e.treasureId+')" class="chest_model card"><div valign="bottom" class="card-header color-white no-border no-padding"><img class="card-cover" src='+e.goodsInfo.picUrl+' alt=""></div><div class="card-content"><div class="card-content-inner list_info"><div class="clearfix stage_info"><p class="stage_text"><span>'+e.goodsInfo.describe+'</span></p></div><div class="clearfix"><div class="schedule pull-left clearfix"><div class="schedule_bar"><div class="scheduling" style="width:'+e.participantCount/e.totalCount*100+'%;"></div></div><div class="pull-left"><p class="schedule_percent">'+e.totalCount+'</p><p>总需</p></div><div class="schedule_text2 pull-right"><p class="schedule_person">'+(e.totalCount-e.participantCount)+'</p><p>剩余</p></div></div><button class="global_button participate button pull-right">立即夺宝</button></div></div></div></div>')}function chestRefresh(){$(".chest_model").remove(),chestFillData(1)}function routerToDuobao(t){$.showIndicator(),$.router.load("duobao.html?treasureId="+t)}function chestBottomLoadmore(t){$(document).off("infinite","#p-chest .infinite-scroll"),$(document).on("infinite","#p-chest .infinite-scroll",function(){chestloadMoreFlag||(chestloadMoreFlag=!0,$.showIndicator(),setTimeout(function(){return chestTotlePage&&t>=chestTotlePage?void setTimeout(function(){$.hideIndicator(),$.toast("没有更多数据",1e3,"toast-80"),setTimeout(function(){chestloadMoreFlag=!1},1e3)},200):void chestFillData(t+1,function(){setTimeout(function(){$.hideIndicator(),$.toast("加载成功",1e3,"toast-80"),chestloadMoreFlag=!1},100)})},100))})}$(function(){try{chestFillData(1),dropRefresh("#p-chest",chestRefresh)}catch(t){}});var chestloadMoreFlag=!1;