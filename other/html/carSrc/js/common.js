"use strict";$(function(){car.init()});var $=function(t){t.FZ=function(t,e){function n(){var n=document.documentElement.clientWidth||document.body.clientWidth,o=t/e*n;return o}document.documentElement.style.fontSize=n()+"px",window.onresize=function(){setTimeout(function(){document.documentElement.style.fontSize=n()+"px"},100)}},t.getUrlParam=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(e);return null!=n?decodeURIComponent(n[2]):null},t.device={ua:navigator.userAgent.toLowerCase(),isAndroid:function(){return!!/android/.test(t.device.ua)},isIos:function(){return!!/iphone/.test(t.device.ua)}};return t.loading={show:function(){t("body").append('<div class="preloader-overlay"><div class="preloader-indicator-modal"><span class="preloader"></span></div></div>')},hide:function(){setTimeout(function(){t("body").find(".preloader-overlay").remove()},100)}},t}(Zepto);$.FZ(20,360);var car=function(t){var e={userId:t.getUrlParam("userId"),srvVersion:"2.3.0"};1==t.getUrlParam("test")?e.getUrl="http://www.7kuaitang.com:8081/raiders/restWeb/":e.getUrl="http://api.2333db.com/raiders/restWeb/","web"==t.getUrlParam("origin")&&(window.alert=window.parent.$.alert);var n=function(){t.loading.show(),t.ajax({type:"post",url:e.getUrl+"getPersonGoods",data:{v:e.srvVersion},async:!0,dataType:"json",success:function(e){console.log(e),0==e.stateCode?t.each(e.goodsList,function(e,n){t(".g-card-wrap").append('\n\t\t\t\t\t\t\t<label class="m-card" for="choose'+e+'">\n\t\t\t\t\t\t\t\t<img src="'+n.icon+'" />\n\t\t\t\t\t\t\t\t<p><span>'+n.describe+"</span></p>\n\t\t\t\t\t\t\t\t<input value='"+n.goodsId+'\' name="choose" id="choose'+e+'" type="checkbox" style="display: none;" />\n\t\t\t\t\t\t\t\t<div class="u-icon"></div>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t')}):alert(e.message),t.loading.hide()}})},o=function(){t("#start").on("click",function(){var n=t(".g-card-wrap").find("input:checked");0==n.length?alert("未选择"):!function(){var o=[];n.each(function(e,n){o.push(t(n).val())});var a=o.join(";");t.loading.show(),t.ajax({type:"post",url:e.getUrl+"createPersonCar",data:{v:e.srvVersion,content:encryptByDES(JSON.stringify({userId:e.userId}))},async:!0,dataType:"json",success:function(e){if(console.log(e),0==e.stateCode){var n=e.car.carId;r(n,a)}else t.loading.hide(),alert(e.message)}})}()})},r=function(n,o){t.ajax({type:"post",url:e.getUrl+"createPersonTreasure",data:{v:e.srvVersion,content:encryptByDES(JSON.stringify({userId:e.userId,carId:n,goodsIdList:o}))},async:!0,dataType:"json",success:function(e){console.log(e),0==e.stateCode?a(n):alert(e.message),t.loading.hide()}})},a=function(e){"web"==t.getUrlParam("origin")?window.parent.carCallBack(e):t.device.isIos()?window.location.href="carshare://"+e:window.callRegister.carshare(e)},s=function(){return t.getUrlParam("userId")?(n(),void o()):void alert("缺少参数userId")};return{init:s}}(Zepto);